(function ($) {
    var adsUrl = "http://egov.ascvn.com.vn/api/ApiQuangCao/";

    $.fn.qcCall = function (sKey, sKey2) {
        var self = this;

        $.post(adsUrl + 'GetAds', {
            'ApiScriptKey': sKey,
            'ApiCode': sKey2
        }, function (result) {
            if (result != null && result.length > 0) {
                a_style = 'display:block!important;color:#46E1FF;text-decoration:none;box-sizing:border-box;color:-webkit-link;cursor:pointer;';

                var html = ''
                $.each(result, function (key, obj) {
                    html += '<div>';
                    html += ' <a class="qc-a-asc" rel="' + obj.Rel + '" target="' + obj.Target + '" style="' + a_style + '" href="' + obj.LienKet + '" data-qcid="' + obj.ID + '" data-skey="' + sKey + '"' + '" data-guidclick="' + obj.GuidClickAds + '">';
                    html += '  <img style="max-width:100% !important;" border="0" src="' + obj.Hinh + '">'
                    html += ' </a>'
                    html += '</div>';
                });

                self.html(html);

                $('.qc-a-asc').click(function () {
                    var _self = this;
                    $.get("http://ipinfo.io", function (response) {
                        $.post(adsUrl + 'GetClickAds', {
                            "IDAds": $(_self).attr('data-qcid'),
                            "GuidClickAds": $(_self).attr('data-guidclick'),
                            "ScriptKey": $(_self).attr('data-skey'),
                            "Loc": response.loc,
                            "LocIP": response.ip,
                            "LocCity": response.city,
                            "LocRegion": response.region,
                            "LocCountry": response.country,
                            "LocTimezone": response.timezone
                        });
                    }, "jsonp");
                });

            }
        })
    };

}(jQuery));

